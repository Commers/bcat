#!/usr/bin/env ruby
# Usage: bcat [<file>]...
# Concatenate <file>s, or standard input, to browser.
require 'bcat'

pid = nil
bcat = Bcat.new($stdin)
bcat.serve! do |sock|
  pid =
    fork do
      [sock, $stdin, $stdout].each { |fd| fd.close }
      exec "open http://#{bcat[:Host]}:#{bcat[:Port]}/#{File.basename(Dir.pwd)}"
    end
end

Process.wait(pid) if pid
